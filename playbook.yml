  # This section is used for connect to server
  # name - this field is used for naming task
  # hosts - in this field we are define hostname/server, in which we want to connect
  # remote_user - this field define user, which we want to use for connect into server
  # become - because we dont want to use root user, we must use sudo privilleges and for this we must set value "yes"
  
- name : Connecting to server  
  hosts: all
  remote_user: D440745
  become: true
  vars:
    ipadrhost: 10.0.0.101


  # This section is used for define all tasks, which we want to do.
  # roles - there we have defined "sections", which will be used.

  roles: 
    - server
    - php
    - mysql
    - wordpress

   tasks:
    - name: Install aptitude
      apt:
        name: aptitude
        state: latest
        update_cache: true
        
    - name: Install rsyslog
      apt:
        pkg:
          - rsyslog
        state: latest
        update_cache: true

    - name: update
      apt:
      upgrade=dist
      force_apt_get=yes

    - name: Add rsyslog conf
      lineinfile:
        dest: /etc/rsyslog.conf
        regexp: '\Z'
        line: '{{ item }}'
      with_items:       
        - "*.* @{{ ipadrhost }}:514"
        - "*.* @{{ ipadrhost }}:50514"
        - "$ActionQueueFileName queue"
        - "$ActionQueueSaveOnShutdown on"
        - "$ActionQueueType LinkedList"
        - "$ActionQueueMaxDiskSpace 1g"
        - "$ActionResumeRetryCount -1"

    - name: Restart rsyslog
      ansible.builtin.service:
       name: rsyslog
       state: restarted
       enabled: true